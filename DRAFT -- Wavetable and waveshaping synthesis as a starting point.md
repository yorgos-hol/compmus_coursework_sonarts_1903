# Δημιουργία synths χρησιμοποιώντας τη wavetable synthesis και τεχνικές waveshaping ως αφετηρία
## Σύνοψη

Η παρούσα εργασία στοχεύει στην αναζήτηση μεθόδων επεξεργασίας κυματομορφών που είναι αποθηκευμένες σε δείγματα. Η επεξεργασία τους αυτή γίνεται στο πλαίσιο δημιουργίας διάφορων synths, με γνώμονα τον πειραματισμό πάνω στον ηχητικό σχεδιασμό. Ο σχεδιασμός ήχων μέσω plug-ins  είναι μία διαδικασία με την οποία είμαι εξοικειωμένος, ωστόσο στο περιβάλλον του κώδικα supercollider απαιτεί κατανόηση μαθηματικών λειτουργιών και λογικής ως η ιεράρχηση και επιλογή ενεργειών και προγραμματισμού συλλογισμών. Επομένως, ο κώδικας τον οποίο συνοδεύει το παρόν κείμενο αποτελεί μία πρώτη απόπειρα εξερεύνησης της λογικής ως μέθοδος παραγωγής ιδιαίτερων ήχων. 

Ο κώδικας περιλαμβάνει μία μέθοδο συμπλήρωσης κυματομορφής η οποία διαβάζεται πλέον ως wavetable. Έπειτα όμως ως βάση χρησιμοποιούνται κυματομορφές αποθηκευμένες σε αρχεία και buffer. Αυτές δημιουργήθηκαν με το πρόγραμμα Audacity, ενώ προβλέπεται και μέθοδος χρήσης οποιουδήποτε ηχητικού δείγματος ως κυματομορφή, καθώς η μέθοδος `Buffer.read` είναι προγραμματισμένη να διαβάζει 512 frames ή όποιον άλλο αριθμό δύναμης του 2 επιλέξουμε, καθιστώντας κάθε sample έτοιμο προς μετατροπή σε wavetable. Αυτό συμβαίνει γιατί στη wavetable synthesis είναι απαραίτητη η χρήση sample που έχουν αριθμό frames ίσο με αριθμό δύναμης του 2, εξαιτίας του modulo που χρησιμοποιεί η γεννήτρια (Bristow-Johnson, R. 1996. Wavetable synthesis 101, a fundamental perspective. In *Audio Engineering Society Convention 101. Audio Engineering Society*. ResearchGate http://www.researchgate.net/ (accessed April 3, 2019)).

Στη συνέχεια επιλέχθηκε η τεχνική waveshaping για την επεξεργασία των κυματομορφών, λόγω του άμεσου όγκου αλλαγών που επιφέρει στον ήχο σε συνδυασμό με κατάλληλες επιλογές modulation.

Σ'αυτό το σημείο πρέπει να σημειωθεί ότι κάποιες μέθοδοι συμπλήρωσης wavetable δεν εφαρμόστηκαν στην παρούσα εργασία, καθώς προτιμήθηκε η διαισθητικότερη παραγωγή κυματομορφών, αλλά κυρίως η χρήση συγκεκριμένων sample. Μία μη περιλαμβανόμενη μέθοδος είναι ο προγραμματισμός κυματομορφής μέσω envelope generator στο supercollider. Παράδειγμα: 

       (
        ~env = Env.new(
	  {rrand(-1.0,1.0)}!11,
	  {exprand(0.001,3)}!10,
	  {rrand(-3.0,6.0)}!10
       );
       )
       ~env.plot; 


Σημ.: για τις ψευδοτυχαίες τιμές διαρκειών επιλέχθηκε το exprand γιατί καταλήγει σε αλλαγές που συμβαίνουν σε όχι υπερβολικά γρήγορο ρυθμό - κάτι που δε θα γινόταν άλλωστε εμφανώς φανερό ακουστικά, ή τουλάχιστον θα ήταν αναποτελεσματικό, άλλωστε, πέραν μίας επιπλέον εισαγωγής θορύβου)
Κάτι που αποφεύχθηκε είναι το γράψιμο συνάρτησης μεταφοράς βάσει απόλυτα συγκεκριμένων, ήδη γνωστών και υπολογισμένων μαθηματικών υπολογισμών π.χ. παραγωγής ημιτονοειδούς κύματος (βλ. τριγωνομετρία κτλ.). Παράδειγμα:

    (
    ~sig = Signal.newClear(513);
    ~sig.waveFill({
	arg x, y, i;
	sin(x)
    }, 0, 4pi)
    )

    ~sig.plot;
    
Σημ.: εδώ παρατηρούμε ότι γίνεται συμπλήρωση 513 frames. Το supercollider σε ανάλογες περιπτώσεις χρειάζεται `2.pow(rrand(2, 20))+1` (αριθμός-δύναμη του 2 + 1) frames.

## Θεωρητικές επισημάνσεις για τις τεχνικές που χρησιμοποιήθηκαν

Η τεχνική waveshaping ανήκει στις μη γραμμικές τεχνικές σύνθεσης και επεξεργασίας, καθώς γίνεται ανάγνωση της κυματομορφής που βρίσκεται στην είσοδο με ταχύτητα και κατεύθυνση μίας άλλης κυματομορφής. Η τελευταία δίνει τη συνάρτηση μεταφοράς για τον τρόπο ανάγνωσης της αρχικής κυματομορφής. Με άλλα λόγια, η πορεία της δεύτερης κυματομορφής (η αλληλουχία των τιμών της) αποτελεί την πορεία του δείκτη (pointer) ανάγνωσης της κυματομορφής εισόδου. Αυτό σημαίνει ότι η κυματομορφή διαβάζεται όχι μόνο προς μία κατεύθυνση, ενώ έχει σαν αποτέλεσμα τη μη γραμμική παραμόρφωση του σήματος, οι παράμετροι της οποίας εξαρτώνται άμεσα από αυτή τη δεύτερη κυματομορφή (Cook, P. R. 2002. *Real sound synthesis for interactive applications*. AK Peters/CRC Press, σελ.109, 115-116).

Η συγκεκριμένη μέθοδος σύνθεσης δεν έχει καθόλου υψηλές υπολογιστικές απαιτήσεις, και επιτυγχάνει εύκολα μεγάλες φασματικές μεταβολές μόνο με τη μεταβολή της έντασης του σήματος, ιδιότητα που φέρουν και πολλοί ήχοι του φυσικού περιβάλλοντος. Τα δύο αυτά χαρακτηριστικά της σύνθεσης αυτής την καθιστούν πολύ ελκυστική για τη δημιουργία και προσομοίωση ήχων ακουστικών μουσικών οργάνων, και, πιο συγκεκριμένα, χάλκινων πνευστών (Smyth, T. 2012. *CMPT 468: Lecture 9, Waveshaping Synthesis*. Computing Science, Simon Fraser University).

## Αναλυτική παρουσίαση του κώδικα

#### (ΓΡΑΜΜΕΣ 2-16) 
Σε αντιδιαστολή με τις τεχνικές σύνθεσης κυματομορφής ως wavetable που αναφέρθηκαν στην παράγραφο "Σύνοψη" χρησιμοποιήθηκε μία (ψευδο)τυχαιοποιημένη μέθοδος συμπλήρωσης τιμών για τις κυματομορφές που δε δημιουργήθηκαν μέσω audacity, όπως είναι η πρώτη. Ο κώδικας φυσικά προσφέρει τη δυνατότητα επιλογής του directory στο οποίο θα αποθηκευτούν οι κυματομορφές για την περαιτέρω χρήση τους αργότερα.

#### (26-74), (76-84) 
Οι δύο αυτές περίοδοι και ειδικότερα η πρώτη (25-72) αποτελούν βασικά σημεία του κώδικα, καθώς περιέχουν ορισμούς στους οποίους πρέπει να γίνει αποτίμηση (evaluation) ώστε να λειτουργήσουν τα υπόλοιπα μέρη του.

#### (26-44) 
Για την πιο βολική συστηματοποίηση της πλοήγησης και του τρόπου εισαγωγής εξωτερικών αρχείων επιλέχθηκε το class dictionary, μία υποκατηγορία `Collection`. Ο λόγος είναι ότι το `Dictionary`, σε αντίθεση με το `Array`, μπορεί να προγραμματιστεί έτσι ώστε να βλέπει όλους τους υποφακέλους ως "λήμματα"-values, των οποίων τα ονόματα καθίστανται ως symbols, κάνοντας τον εντοπισμό και την επιλογή αρχείων και φακέλων πολύ εύκολη. Επισημαίνεται εδώ ότι παρέχεται επιλογή του αριθμού frames που επιθυμούμε να αναπαράγονται από το buffer. Το εύρος από 2 έως 20 του παράγοντα τυχαιότητας που εισάγεται στον κώδικα με το `rrand` μπορεί να διατηρηθεί ως μία οδηγία των αριθμών που μπορούν να χρησιμοποιηθούν ως εκθέτες στη συγκεκριμένη λειτουργία, αν υπάρχει ανάγκη επιλογής συγκεκριμένου αριθμού.

#### (51-57) 
Tο πρώτο synth επιλέγει (όπως και όλα τα ακόλουθα) τυχαία μία από τις αποθηκευμένες σε buffers κυματομορφές, και φτιάχνει μία μελωδία που πατάει σε μία συγκεκριμένη μουσική σκάλα (από την ινδική raga Ahir Bhairav), ξεκινώντας από το midi number 60 και μετατρέποντας τις συγκεκριμένες σχέσεις με τη βάση 60 στην παραπάνω κλίμακα σε συχνότητες στις οποίες θα επαναλάβει την τυχαία επιλεγμένη κυματομορφή. Χρησιμοποιείται μία γεννήτρια περιβάλλουσας, η οποία επιλέγεται να ελευθερώνει το synth μετά την ολοκλήρωσή της λειτουργίας της.

#### (60-74) 
Ακολουθεί ένας ορισμός προτύπου-μοτίβου (`Pattern`) χρήσης του παραπάνω synth και αυτής της σκάλας με κάποιες συναρτήσεις τυχαιότητας, άλλοτε εκθετικής (`Pexprand`) κι άλλοτε χωρίς κάποια τάση προτίμησης τιμών προς μία κατεύθυνση (π.χ. `Pwhite`).

#### (76-84) 
Ορίζεται το reverb, με μείωση της ενίσχυσης για αποφυγή ψαλιδισμού και με βάση την κατάλληλη δρομολόγηση των busses (είσοδοι-έξοδοι).

#### (87-91) 
Το πρώτο `Pattern` μπαίνει σε λειτουργία με επιλογή τερματισμού. Η γραμμή του reverb (βλ. γραμμή 89) περιλαμβάνει τον όρο `\addToTail`, ώστε να αποκλειστεί κάθε ενδεχόμενο λάθος ιεράρχησης και σειράς evaluation των γραμμών, σε περίπτωση τροποποίησης του κώδικα, καθώς το reverb χρειάζεται υπάρχον σήμα για να του προσθέσει την αντήχηση.

#### (95-96) 
Δεύτερο `Pattern` που επιτρέπει την απεικόνιση των τιμών που πραγματώνει σε πραγματικό χρόνο στο post window, πράγμα που βοηθάει, καθώς ακολουθεί έναν ιδιόρρυθμο αλγόριθμο παραγωγής αλληλουχίας παλμών. Συχνοτικά, όλοι οι ήχοι προέρχονται από μία όχι τελείως αυθαίρετη, σχεδόν αρμονική σειρά, καθώς επιλέγονται βάσει στρογγυλοποίησης.

#### (98-100) 
Επιπλέον ενδεικτικά προαιρετικά synths

#### (107-118) 
Το πρώτο synth που χρησιμοποιεί μία τυχαία επιλεγμένη κυματομορφή ως ευρετήριο για τον `Shaper` που θα παράγει τελικά το κύριο σήμα. Ο (wave)`Shaper` στην πραγματικότητα καθορίζει τη σειρά με την οποία συγκεκριμένα τμήματα της κυματομορφής διαβάζονται σε συγκεκριμένες χρονικές στιγμές και για συγκεκριμένες χρονικές διάρκειες (με συγκεκριμένο ρυθμό), στη δική μας περίπτωση βάσει της αποθηκευμένης κυματομορφής που ορίζει με βάση τις δικές της τιμές (κατευθυντικότητα στο χρόνο και rate (frequency) ανάγνωσης) τις μόλις αναφερθείσες παραμέτρους. Η αποθηκευμένη κυματομορφή λειτουργεί έτσι ως συνάρτηση μεταφοράς του `index`.Μάλιστα ο τρόπος που λειτουργεί το ευρετήριο εδώ ελέγχεται από τη θέση του ποντικιού στον οριζόντιο άξονα, η οποία καθορίζει το τμήμα της κυματομορφής που κατατάσσεται στο ευρετήριο (`index`), αλλάζοντας τελικά δηλαδή την ένταση του σήματος. 

#### (124-140) 
Εδώ παρέχεται ένα πειραματικό, μινιμαλιστικό, ρυθμικό synth pattern (αν και χρησιμοποιεί τη `Routine` και όχι το `Pattern` για να δημιουργήσει τη μουσική φράση), που βασίζεται στην υπέρβαση των υπολογιστικών-αποθηκευτικών ορίων του συστήματος, και πιο συγκεκριμένα στο lag error. Μάλιστα, κάνει χρήση της μεθόδου ελέγχου ροής 'while loop' για την επανάληψη της `Routine`. Οι πολλαπλές iterations της αναπαραγωγής των αρχείων στα buffers δεν επιτρέπουν στο σύστημα να πραγματοποιήσει όλες αυτές που ανήκουν στην ίδια γραμμή (π.χ. το `50.do`) την ίδια στιγμή, με αποτέλεσμα την αναπαραγωγή τους σε σειρά, σαν να επαναλαμβάνονται με μία σχεδόν σταθερή συχνότητα (η οποία υποθέτω θα είναι για το `50.do`: 50 * τη χρονική διάρκεια του sample + όσα msecs είναι το lag).

#### (143-160) 
Μία ακόμη χρήση iteration για την εκκίνηση 50 synths που χρησιμοποιούν την ίδια κατασκευή, αλλά άντληση ευρετηρίων (indexes) από μία εκτενή δεξαμενή διαφορετικών κυματομορφών, η καθεμία των οποίων δύναται να έχει συχνότητα που εντοπίζεται ανάμεσα σε ένα συγκεκριμένο κάθε φορά εύρος ή, συνήθως, συγκεκριμένη τιμή ανά κανάλι. Μιλώντας για κανάλια, η στερεοφωνική κατανομή του σήματος γίνεται βάσει του UGen `Splay`, που διασπείρει τα κανάλια κατά μήκος του στερεοφωνικού πεδίου. Ο αριθμός των καναλιών δεν είναι ίδιος με τον αριθμό των iterations. 

Επίσης, σε αυτό και σε όλα τα synths που ακολουθούν, υπάρχουν εναλλακτικές τιμές ή αλγόριθμοι για ορισμένα arguments και τα variables, τα οποία πρέπει να επιλεχθούν "απενεργοποιώντας" τη μη επιθυμητή επιλογή μέσω της μετατροπής της σε σχόλιο ('//' ή πληκτρολογώντας 'cmd+/' -mac- ή 'Ctrl+/' -windows-). Συγκεκριμένα σ'αυτήν την παράγραφο, υπάρχει και μία εναλλακτική επιλογή σε πειραματικό στάδιο, που καθιστά την επιλογή του buffer 'υποχείριο' της θέσης του ποντικιού, κάτι που δε λειτουργεί ως περιμένουμε, αλλά προξενεί ενδιαφέροντα clicks σε κάθε κίνηση του ποντικιού, και, προφανώς, ιδιαίτερα πλούσιο ήχο με το γρήγορο σύρσιμό του.

#### (162-178 και μέχρι 261)
Η αρχή μιας σειράς από ορισμών synths, τα οποία διαδοχικά επιδέχονται τροποποιήσεις ή προσθήκες, διαμορφώνοντας διαφορετικό ηχητικό αποτέλεσμα. Αρχικά, ένα synth με resonant filter, του οποίου η resonant frequency ορίζεται σε πραγματικό χρόνο βάσει της ιχνηλάτησης των κορυφών της έντασης του σήματος που έρχεται από 5 ταλαντωτές. Αυτό οδηγεί σε ένα ουσιαστικά low pass resonant filter. Η ποιότητα του φίλτρου επιλέγεται τυχαία από τιμές που έχουν εύρος από 0.0000001 έως 0.00001. Εισάγεται και το αντικείμενο `LeakDC` που αφαιρεί το dc offset, καθώς οι κυματομορφές που παράγονται δεν είναι ελεγχόμενες.

#### (182-199) 
Το synth `\detunwav`, διατηρώντας τη δομή του παραπάνω synth, είναι μία ειρωνική προσέγγιση του όρου detune, καθότι η παρέκκλιση γίνεται από έναν άγνωστο σε μας τονικό πυρήνα, ανάμεσα μάλιστα σε διάφορα ανεξάρτητα παρεκκλίνοντα τονικά κέντρα που επίσης είναι δύσκολο να εντοπιστούν από το αυτί, εφόσον υπάρχει και η συνεχής ηχητική αναδιαμόρφωση μέσω της κίνησης του ποντικιού. Πλέον, η συχνότητα φίλτρου που εντείνεται, αν και εξακολουθεί να ορίζεται από το amplitude follower, είναι σταθερά ψηλότερη, καθώς παρέχεται ένα μαξιλαράκι της τάξης 180 με 340 Hz. 

Η τιμή του detune είναι 0.1 (βλ. γραμμή 187), ενώ το spread, δηλαδή η περαιτέρω απομάκρυνση του κάθε ταλαντωτή τόσο από τον κεντρικό όσο και από τον αμέσως κοντινότερο στον κεντρικό - κάτι που εδώ, ειρωνικά, δεν υπάρχει, καθώς κάθε ταλαντωτής είναι ανεξάρτητος και έχει άλλο τονικό κέντρο - δημιουργείται με τη χρήση του counter `i`. Το vibrato, πιο μικροδομικά, και το πλάτος του detuning, πιο μακροδομικά (με μεγαλύτερη περίοδο), με την συμπερίληψη της πρόσθεσης στη συνάρτηση, καθορίζεται από το πλάτος της έντασης του `SinOsc`.

Το φίλτρο αποκτά χαμηλότερη τιμή ποιότητας (εδώ χρησιμοποιείται το αντίστροφο του q, bandwidth ratio, οπότε οι τιμές μεγαλώνουν), αφήνοντας αρκετά περισσότερες συχνοτικές ζώνες να περάσουν στον ακουστό χώρο, διατηρώντας όμως πάλι τον παράγοντα της τυχαιότητας.

Η ένταση του σήματος, δεδομένης της ανεξέλεγκτης φύσης ενός resonant φίλτρου, επιχειρείται να ελεγχθεί με τη χρήση του `.reciprocal` (της αντίστροφης τιμής), και με την προσθήκη δύο επιπλέον παραγόντων: της διαίρεσης της έντασης του σήματος στους 5 ταλαντωτές (που όμως αν το σκεφτούμε καλύτερα είναι 10 ή 11, με τα διπλά και τριπλά κανάλια), και της προσθήκης ενός μαξιλαριού.

#### (203-226) 
Το παραπάνω synth μετατρέπεται σε ένα πολυ-synth με πολυρυθμική υφή και μικρογεγονότα που συμβαίνουν στα διάφορα, κολλημένα το ένα στο άλλο, στρώματά του, δημιουργώντας έτσι ένα ηχητικό περιβάλλον. Εδώ οι δυνατές τιμές που μπορούν να έχουν τα ευρετήρια επηρεάζονται από τον αριθμό του ταλαντωτή, μέσω του counter `i`, κι από άλλες μαθηματικές ενέργειες, συμπεριλαμβανομένων της τετραγωνικής ρίζας, κλασμάτων, δυνάμεων κτλ. Δοκιμάστηκαν όλα τα είδη παραγωγής θορύβου χαμηλής συχνότητας που υπάρχουν στο supercollider. Μία ακόμη τροποποίηση είναι στον τρόπο που υπολογίζεται σε κάθε χρονική στιγμή η συχνότητα συντονισμού. Αυτή τη φορά προσδίδεται μία αρμονικότητα μέσω της στρογγυλοποίησης και της ταυτόχρονης ακρόασης του φίλτρου κάθε ταλαντωτή, αλλά και της επιλογής πιο υψηλών συχνοτικών περιοχών.

Στο συγκεκριμένο αλλά και στο επόμενο synth, τα ευρετήρια και η ενίσχυση του σήματος έχουν εναλλακτικές επιλογές. Το εναλλακτικό `index` παράγει πιο υψηλές συχνότητες και πιο γρήγορα και ευκρινή περάσματα μεταξύ τους. Οι επιλογές για την ενίσχυση συγκεκριμένα αφορούν την εξάρτησή της είτε από την εκάστοτε συχνότητα συντονισμού, είτε από την - αυτή είναι μη εναλλασσόμενη σε πραγματικό χρόνο - ποιότητα των φίλτρων του κάθε ταλαντωτή.
 
#### (232-258) 
Το τελευταίο synth παράγει ήχους πιο κοντά στη φύση των κρουστών οργάνων, ή και, με μικρές αλλαγές στις τιμές, μικρής διάρκειας υγρούς και λεπτούς ήχους με έντονη κίνηση, attack και resonance. Αυτό συμβαίνει λόγω της προσθήκης της γεννήτριας περιβάλλουσας στη διαμόρφωση του σήματος. Η σύντομη χρονικά φύση των συγκεκριμένων ταλαντωτών επιτρέπει την προσθήκη μεγαλύτερου αρθιμού τους.

#### (266-270) 
Η τελευταία `Pattern` είναι μία τροποποίηση της πρώτης. Κεντρικό ρόλο σ'αυτήν έχει η λειτουργία `Pstutter`, που πραγματοποιεί έναν σταθερό αριθμό επαναλήψεων για κάθε τιμή στο key στο οποίο έχει ανατεθεί. Η επιλογή αυτής της λειτουργίας είχε ως στόχο την πρόκληση ενδιαφέροντος, δεδομένης της μονότονης πρώτης ύλης μας, που είναι ένας μονότονος χτύπος. Αυτό μπορεί να επιτευχθεί μέσω της επανάληψης, η οποία δημιουργεί υπό-patterns και αναγνωρίσιμα μοτίβα. 

Αυτή η `Pattern` επιβάλλεται να σημειωθεί ότι μπορεί να χρησιμοποιηθεί και από τα προηγούμενα synth, αν τους προστεθεί ένα `EnvGen` που επιτρέπει την απελευθέρωσή τους μετά το κλείσιμο της περιβάλλουσας μέσω του `doneAction: 2`, όπως γίνεται στο παραπάνω synth `\Hayperc`. Αυτό είναι κάτι που δε θα μπορούσε να γίνει χωρίς την απελευθέρωση των synths, λόγω του πεπερασμένου μεγέθους της μνήμης του συστήματος, αλλά και της φύσης των πιο προηγούμενων synths που πλησιάζει τον χαρακτήρα του drone (βλ. προβλήματα ευκρίνειας και έντασης).      
	

